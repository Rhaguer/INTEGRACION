trigger:
- main

variables:
  azureSubscription: '<Tu conexion servicio Azure>'
  appName: '<Nombre Azure Function App>'
  vmImageName: 'ubuntu-latest'

pool:
  vmImage: $(vmImageName)

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.9'

- script: |
    python -m pip install --upgrade pip
    pip install -r requirements.txt
  displayName: 'Instalar dependencias'

- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(System.DefaultWorkingDirectory)'
    includeRootFolder: false
    archiveFile: '$(Build.ArtifactStagingDirectory)/functionapp.zip'
    replaceExistingArchive: true
  displayName: 'Crear paquete'

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)/functionapp.zip'
    artifactName: 'drop'
  displayName: 'Publicar artefactos'

- task: AzureFunctionApp@2
  inputs:
    azureSubscription: $(azureSubscription)
    appType: functionAppLinux
    appName: $(appName)
    package: '$(Build.ArtifactStagingDirectory)/functionapp.zip'
    deploymentMethod: 'auto'
